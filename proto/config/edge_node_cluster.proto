// Copyright(c) 2024 Zededa, Inc.
// All rights reserved.

syntax = "proto3";

package org.lfedge.eve.config;
option go_package = "github.com/lf-edge/eve-api/go/config";
option java_package = "org.lfedge.eve.config";

import "evecommon/acipherinfo.proto";

enum ClusterType {
  CLUSTER_TYPE_UNSPECIFIED = 0;
  CLUSTER_TYPE_K3S_BASE = 1;
  CLUSTER_TYPE_REPLICATED_STORAGE = 2;
  CLUSTER_TYPE_HA = 3;
}

message EdgeNodeCluster {
  // cluster name, in case it has multiple cluster on the same site
  string cluster_name = 1;

  // cluster UUID
  string cluster_id = 2;

  // Cluster-Interface, for example "mgmt0", this is the logicallabel of the physicalIO
  string cluster_interface = 3;

  // the 'cluster-prefix' IP address of the 'Cluster-Interface', 10.244.244.2/28
  string cluster_ip_prefix = 4;

  // This device is an 'Agent' node
  bool is_worker_node = 5;

  // Server IP address to join the cluster. E.g. 10.244.244.1
  string join_server_ip = 6;

  // encrypted token string, use edge-node TPM to decrypt
  org.lfedge.eve.common.CipherBlock encrypted_cluster_token = 7;

  // Cluster Type for eve to determine component, app, and volume scheduling needs
  ClusterType cluster_type = 8;

  // Node Id for eve to disable all pod scheduling
  // EVE-OS should use this to set kubernetes node labels identifying
  // the tie-breaker node to the kubernetes scheduler.
  // Node labels are used in the node selector specification of
  // kubernetes objects to direct pod scheduling away from a
  // specific node due to node limitations.
  string tie_breaker_node_id = 9;
}
